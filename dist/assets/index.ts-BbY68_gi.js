import{s as u}from"./storage-DaJmYFgk.js";async function c(t,o){var r,s,n;try{const e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify({model:t.model||"gpt-3.5-turbo",messages:o,temperature:.3,max_tokens:1e3})});if(!e.ok){const i=await e.json().catch(()=>({}));throw console.error("OpenAI API Error:",e.status,i),e.status===401?new Error("Invalid API Key"):e.status===429?new Error("Rate Limit Exceeded"):new Error(((r=i.error)==null?void 0:r.message)||`API Error: ${e.status}`)}return((n=(s=(await e.json()).choices[0])==null?void 0:s.message)==null?void 0:n.content)||""}catch(e){throw console.error("Fetch Completion Error:",e),e}}function d(t,o){const r=`You are a professional translator and language expert. 
Your task is to translate the user's text into the target language: ${t}.
Output ONLY the translated text. Do not add any explanations, notes, or quotes unless asked.
Maintain the original tone and formatting.`;return o?`${r}
Context: ${o}`:r}console.log("Tippr Background Service Worker started");chrome.runtime.onMessage.addListener((t,o,r)=>{if(console.log("Background received message:",t),t.type==="PING"){r({status:"ok"});return}if(t.type==="TRANSLATE_REQUEST")return m(t.payload,r),!0;if(t.type==="VALIDATE_API_KEY")return y(t.payload.key,r),!0});async function m(t,o){var r,s,n;try{const e=await u.get();if(!e.apiKey){o({success:!1,error:"API Key is missing. Please configure it in settings."});return}const i=[{role:"system",content:d(t.targetLang,t.context)},{role:"user",content:t.text}],l=await c({apiKey:e.apiKey,model:e.model},i);o({success:!0,data:l})}catch(e){console.error("Translation error:",e);let a="Unknown error occurred";(r=e.message)!=null&&r.includes("401")?a="Invalid API key. Please check your OpenAI API key.":(s=e.message)!=null&&s.includes("429")?a="Rate limit exceeded. Please try again later.":(n=e.message)!=null&&n.includes("quota")?a="API quota exceeded. Please check your OpenAI billing.":e.message&&(a=e.message),o({success:!1,error:a})}}async function y(t,o){try{await c({apiKey:t,model:"gpt-3.5-turbo"},[{role:"user",content:"Hi"}]),o({success:!0})}catch{o({success:!1,error:"Invalid API Key"})}}
