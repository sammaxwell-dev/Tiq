import{s as c}from"./storage-DaJmYFgk.js";async function i(t,r){var e,n,a;try{const o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify({model:t.model||"gpt-3.5-turbo",messages:r,temperature:.3,max_tokens:1e3})});if(!o.ok){const s=await o.json().catch(()=>({}));throw console.error("OpenAI API Error:",o.status,s),o.status===401?new Error("Invalid API Key"):o.status===429?new Error("Rate Limit Exceeded"):new Error(((e=s.error)==null?void 0:e.message)||`API Error: ${o.status}`)}return((a=(n=(await o.json()).choices[0])==null?void 0:n.message)==null?void 0:a.content)||""}catch(o){throw console.error("Fetch Completion Error:",o),o}}function u(t,r){const e=`You are a professional translator and language expert. 
Your task is to translate the user's text into the target language: ${t}.
Output ONLY the translated text. Do not add any explanations, notes, or quotes unless asked.
Maintain the original tone and formatting.`;return r?`${e}
Context: ${r}`:e}console.log("Tippr Background Service Worker started");chrome.runtime.onMessage.addListener((t,r,e)=>{if(console.log("Background received message:",t),t.type==="PING"){e({status:"ok"});return}if(t.type==="TRANSLATE_REQUEST")return l(t.payload,e),!0;if(t.type==="VALIDATE_API_KEY")return p(t.payload.key,e),!0});async function l(t,r){try{const e=await c.get();if(!e.apiKey){r({success:!1,error:"API Key is missing. Please configure it in settings."});return}const a=[{role:"system",content:u(t.targetLang,t.context)},{role:"user",content:t.text}],o=await i({apiKey:e.apiKey,model:e.model},a);r({success:!0,data:o})}catch(e){console.error("Translation error:",e),r({success:!1,error:e.message||"Unknown error"})}}async function p(t,r){try{await i({apiKey:t,model:"gpt-3.5-turbo"},[{role:"user",content:"Hi"}]),r({success:!0})}catch{r({success:!1,error:"Invalid API Key"})}}
